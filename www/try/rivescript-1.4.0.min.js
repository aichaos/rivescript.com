/* rivescript 1.4.0 -- built on 2016-02-26 11:10:06 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.RiveScript=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d,e,f,g;g=a("./utils"),f=a("./inheritance"),e=a("rsvp"),d=function(){function a(a){this.master=a,this.strict=a._strict,this.utf8=a._utf8,this._currentUser=null}return a.prototype.say=function(a){return this.master.say(a)},a.prototype.warn=function(a,b,c){return this.master.warn(a,b,c)},a.prototype.reply=function(a,b,c,d){var e,f;return this.say("Asked to reply to ["+a+"] "+b),this._currentUser=a,b=this.formatMessage(b),f="",this.master._topics.__begin__?(e=this._getReply(a,"request","begin",0,c),e.indexOf("{ok}")>-1&&(f=this._getReply(a,b,"normal",0,c),e=e.replace(/\{ok\}/g,f)),f=e,f=this.processTags(a,b,f,[],[],0,c)):f=this._getReply(a,b,"normal",0,c),f=this.processCallTags(f,c,d),g.isAPromise(f)?f.then(function(c){return function(d){return c.onAfterReply(b,a,d)}}(this)):this.onAfterReply(b,a,f),f},a.prototype.onAfterReply=function(a,b,c){return this.master._users[b].__history__.input.pop(),this.master._users[b].__history__.input.unshift(a),this.master._users[b].__history__.reply.pop(),this.master._users[b].__history__.reply.unshift(c),this._currentUser=void 0},a.prototype.processCallTags=function(a,b,c){var d,f,h,i,j,k,l,m,n,o,p,q,r;for(a=a.replace(/\{__call__\}/g,"<call>"),a=a.replace(/\{\/__call__\}/g,"</call>"),f=/<call>(.+?)<\/call>/gi,i=0,m={},q=[];;){if(i++,i>=50){this.warn("Infinite loop looking for call tag!");break}if(l=f.exec(a),!l)break;r=g.strip(l[1]),p=r.split(/\s+/),n=p.shift(),d=p,m[l[1]]={text:r,obj:n,args:d}}for(j in m){if(h=m[j],o="",this.master._objlangs[h.obj]?(k=this.master._objlangs[h.obj],o=this.master._handlers[k]?this.master._handlers[k].call(this.master,h.obj,h.args,b):"[ERR: No Object Handler]"):o="[ERR: Object Not Found]",g.isAPromise(o)){if(c){q.push({promise:o,text:j});continue}o="[ERR: Using async routine with reply: use replyAsync instead]"}a=this._replaceCallTags(j,o,a)}return c?new e.Promise(function(b){return function(c,d){var f;return e.all(function(){var a,b,c;for(c=[],a=0,b=q.length;b>a;a++)f=q[a],c.push(f.promise);return c}()).then(function(d){var e,f,g;for(e=f=0,g=d.length;g>=0?g>f:f>g;e=g>=0?++f:--f)a=b._replaceCallTags(q[e].text,d[e],a);return c(a)})["catch"](function(a){return d(a)})}}(this)):a},a.prototype._replaceCallTags=function(a,b,c){return c.replace(new RegExp("<call>"+g.quotemeta(a)+"</call>","i"),b)},a.prototype._getReply=function(a,b,c,d,e){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka;if(!this.master._sorted.topics)return this.warn("You forgot to call sortReplies()!"),"ERR: Replies Not Sorted";if(this.master._users[a]||(this.master._users[a]={topic:"random"}),ga=this.master._users[a].topic,da=[],ea=[],_="",this.master._topics[ga]||(this.warn("User "+a+" was in an empty topic named '"+ga+"'"),ga=this.master._users[a].topic="random"),d>this.master._depth)return"ERR: Deep Recursion Detected";if("begin"===c&&(ga="__begin__"),this.master._users[a].__history__||(this.master._users[a].__history__={input:["undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined"],reply:["undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined"]}),!this.master._topics[ga])return"ERR: No default topic 'random' was found!";if(G=null,H=null,o=!1,0===d)for(h=[ga],(this.master._topics[ga].includes||this.master._topics[ga].inherits)&&(h=f.getTopicTree(this.master,ga)),u=0,y=h.length;y>u;u++)if(fa=h[u],this.say("Checking topic "+fa+" for any %Previous's"),this.master._sorted.thats[fa])for(this.say("There's a %Previous in this topic!"),w=this.master._users[a].__history__.reply[0],w=this.formatMessage(w,!0),this.say("Last reply: "+w),S=this.master._sorted.thats[fa],v=0,z=S.length;z>v;v++)if(ha=S[v],N=ha[0],i=this.triggerRegexp(a,N),this.say("Try to match lastReply ("+w+") to "+i),F=w.match(new RegExp("^"+i+"$")),F&&(this.say("Bot side matched!"),ea=F,ea.shift(),ia=ha[1],Z=this.triggerRegexp(a,ia.trigger),this.say('Try to match "'+b+'" against '+ia.trigger+" ("+Z+")"),s=g.isAtomic(ia.trigger),t=!1,s?b===Z&&(t=!0):(F=b.match(new RegExp("^"+Z+"$")),F&&(t=!0,da=F,da.length>=1&&da.shift())),t)){G=ia,o=!0,H=ia.trigger;break}if(!o)for(this.say("Searching their topic for a match..."),T=this.master._sorted.topics[ga],E=0,A=T.length;A>E;E++){if(ha=T[E],N=ha[0],Z=this.triggerRegexp(a,N),this.say('Try to match "'+b+'" against '+N+" ("+Z+")"),s=g.isAtomic(N),t=!1,s)b===Z&&(t=!0);else if(F=b.match(new RegExp("^"+Z+"$")),F&&(t=!0,da=[],F.length>1))for(r=I=1,U=F.length;U>=1?U>=I:I>=U;r=U>=1?++I:--I)da.push(F[r]);if(t){this.say("Found a match!"),G=ha[1],o=!0,H=N;break}}if(this.master._users[a].__lastmatch__=H,G)for(V=[1],L=0,B=V.length;B>L;L++){if(K=V[L],null!=G.redirect){this.say("Redirecting us to "+G.redirect),R=this.processTags(a,b,G.redirect,da,ea,d,e),this.say("Pretend user said: "+R),_=this._getReply(a,R,c,d+1,e);break}for(W=G.condition,P=0,C=W.length;C>P;P++)if(ba=W[P],q=ba.split(/\s*=>\s*/),q&&2===q.length&&(l=q[0].match(/^(.+?)\s+(==|eq|!=|ne|<>|<|<=|>|>=)\s+(.*?)$/))){if(x=g.strip(l[1]),n=l[2],aa=g.strip(l[3]),O=g.strip(q[1]),x=this.processTags(a,b,x,da,ea,d,e),aa=this.processTags(a,b,aa,da,ea,d,e),0===x.length&&(x="undefined"),0===aa.length&&(aa="undefined"),this.say("Check if "+x+" "+n+" "+aa),M=!1,"eq"===n||"=="===n)x===aa&&(M=!0);else if("ne"===n||"!="===n||"<>"===n)x!==aa&&(M=!0);else try{x=parseInt(x),aa=parseInt(aa),"<"===n&&aa>x?M=!0:"<="===n&&aa>=x?M=!0:">"===n&&x>aa?M=!0:">="===n&&x>=aa&&(M=!0)}catch(la){m=la,this.warn("Failed to evaluate numeric condition!")}if(M){_=O;break}}if(void 0!==_&&_.length>0)break;for(j=[],X=G.reply,Q=0,D=X.length;D>Q;Q++)for($=X[Q],ka=1,F=$.match(/\{weight=(\d+?)\}/i),F&&(ka=F[1],0>=ka&&(this.warn("Can't have a weight <= 0!"),ka=1)),r=ca=0,Y=ka;Y>=0?Y>=ca:ca>=Y;r=Y>=0?++ca:--ca)j.push($);k=parseInt(Math.random()*j.length),_=j[k];break}if(o?(void 0===_||0===_.length)&&(_="ERR: No Reply Found"):_="ERR: No Reply Matched",this.say("Reply: "+_),"begin"===c){for(F=_.match(/\{topic=(.+?)\}/i),p=0;F;){if(p++,p>=50){this.warn("Infinite loop looking for topic tag!");break}J=F[1],this.master._users[a].topic=J,_=_.replace(new RegExp("{topic="+g.quotemeta(J)+"}","ig"),""),F=_.match(/\{topic=(.+?)\}/i)}for(F=_.match(/<set (.+?)=(.+?)>/i),p=0;F;){if(p++,p>=50){this.warn("Infinite loop looking for set tag!");break}J=F[1],ja=F[2],this.master._users[a][J]=ja,_=_.replace(new RegExp("<set "+g.quotemeta(J)+"="+g.quotemeta(ja)+">","ig"),""),F=_.match(/<set (.+?)=(.+?)>/i)}}else _=this.processTags(a,b,_,da,ea,d,e);return _},a.prototype.formatMessage=function(a,b){return a=""+a,a=a.toLowerCase(),a=this.substitute(a,"sub"),this.utf8?(a=a.replace(/[\\<>]+/,""),null!=this.master.unicodePunctuation&&(a=a.replace(this.master.unicodePunctuation,"")),null!=b&&(a=a.replace(/[.?,!;:@#$%^&*()]/,""))):a=g.stripNasties(a,this.utf8),a=a.trim(),a=a.replace(/\s+/g," ")},a.prototype.triggerRegexp=function(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s;for(b=b.replace(/^\*$/,"<zerowidthstar>"),b=b.replace(/\*/g,"(.+?)"),b=b.replace(/#/g,"(\\d+?)"),b=b.replace(/_/g,"(\\w+?)"),b=b.replace(/\{weight=\d+\}/g,""),b=b.replace(/<zerowidthstar>/g,"(.*?)"),this.utf8&&(b=b.replace(/\\@/,"\\u0040")),k=b.match(/\[(.+?)\]/),c=0;k;){if(c++>50)return this.warn("Infinite loop when trying to process optionals in a trigger!"),"";for(o=k[1].split("|"),m=[],e=0,h=o.length;h>e;e++)n=o[e],m.push("(?:\\s|\\b)+"+n+"(?:\\s|\\b)+");p=m.join("|"),p=p.replace(new RegExp(g.quotemeta("(.+?)"),"g"),"(?:.+?)"),p=p.replace(new RegExp(g.quotemeta("(\\d+?)"),"g"),"(?:\\d+?)"),p=p.replace(new RegExp(g.quotemeta("(\\w+?)"),"g"),"(?:\\w+?)"),p=p.replace(/\[/g,"__lb__").replace(/\]/g,"__rb__"),b=b.replace(new RegExp("\\s*\\["+g.quotemeta(k[1])+"\\]\\s*"),"(?:"+p+"|(?:\\b|\\s)+)"),k=b.match(/\[(.+?)\]/)}for(b=b.replace(/__lb__/g,"[").replace(/__rb__/g,"]"),b=b.replace(/\\w/,"[A-Za-z]"),c=0;b.indexOf("@")>-1&&!(c++>50);)k=b.match(/\@(.+?)\b/),k&&(l=k[1],r="",this.master._array[l]&&(r="(?:"+this.master._array[l].join("|")+")"),b=b.replace(new RegExp("@"+g.quotemeta(l)+"\\b"),r));for(c=0;b.indexOf("<bot")>-1&&!(c++>50);)k=b.match(/<bot (.+?)>/i),k&&(l=k[1],r="",this.master._var[l]&&(r=g.stripNasties(this.master._var[l])),b=b.replace(new RegExp("<bot "+g.quotemeta(l)+">"),r.toLowerCase()));for(c=0;b.indexOf("<get")>-1&&!(c++>50);)k=b.match(/<get (.+?)>/i),k&&(l=k[1],r="undefined","undefined"!=typeof this.master._users[a][l]&&(r=this.master._users[a][l]),b=b.replace(new RegExp("<get "+g.quotemeta(l)+">","ig"),r.toLowerCase()));for(c=0,b=b.replace(/<input>/i,"<input1>"),b=b.replace(/<reply>/i,"<reply1>");(b.indexOf("<input")>-1||b.indexOf("<reply")>-1)&&!(c++>50);)for(q=["input","reply"],f=0,i=q.length;i>f;f++)for(s=q[f],d=j=1;9>=j;d=++j)b.indexOf("<"+s+d+">")>-1&&(b=b.replace(new RegExp("<"+s+d+">","g"),this.master._users[a].__history__[s][d]));return this.utf8&&b.indexOf("\\u")>-1&&(b=b.replace(/\\u([A-Fa-f0-9]{4})/,function(a,b){return String.fromCharCode(parseInt(b,16))})),b},a.prototype.processTags=function(a,b,c,d,e,f,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;for(D=[""],D.push.apply(D,d),i=[""],i.push.apply(i,e),1===D.length&&D.push("undefined"),1===i.length&&i.push("undefined"),t=c.match(/\(@([A-Za-z0-9_]+)\)/i),m=0;t;){if(m++>this.master._depth){this.warn("Infinite loop looking for arrays in reply!");break}v=t[1],C=this.master._array[v]?"{random}"+this.master._array[v].join("|")+"{/random}":"\x00@"+v+"\x00",c=c.replace(new RegExp("\\(@"+g.quotemeta(v)+"\\)","ig"),C),t=c.match(/\(@([A-Za-z0-9_]+)\)/i)}for(c=c.replace(/\x00@([A-Za-z0-9_]+)\x00/g,"(@$1)"),c=c.replace(/<person>/gi,"{person}<star>{/person}"),c=c.replace(/<@>/gi,"{@<star>}"),c=c.replace(/<formal>/gi,"{formal}<star>{/formal}"),c=c.replace(/<sentence>/gi,"{sentence}<star>{/sentence}"),c=c.replace(/<uppercase>/gi,"{uppercase}<star>{/uppercase}"),c=c.replace(/<lowercase>/gi,"{lowercase}<star>{/lowercase}"),c=c.replace(/\{weight=\d+\}/gi,""),c=c.replace(/<star>/gi,D[1]),c=c.replace(/<botstar>/gi,i[1]),n=p=1,z=D.length;z>=1?z>=p:p>=z;n=z>=1?++p:--p)c=c.replace(new RegExp("<star"+n+">","ig"),D[n]);for(n=q=1,A=i.length;A>=1?A>=q:q>=A;n=A>=1?++q:--q)c=c.replace(new RegExp("<botstar"+n+">","ig"),i[n]);for(c=c.replace(/<input>/gi,this.master._users[a].__history__.input[0]),c=c.replace(/<reply>/gi,this.master._users[a].__history__.reply[0]),n=s=1;9>=s;n=++s)c.indexOf("<input"+n+">")>-1&&(c=c.replace(new RegExp("<input"+n+">","ig"),this.master._users[a].__history__.input[n])),c.indexOf("<reply"+n+">")>-1&&(c=c.replace(new RegExp("<reply"+n+">","ig"),this.master._users[a].__history__.reply[n]));for(c=c.replace(/<id>/gi,a),c=c.replace(/\\s/gi," "),c=c.replace(/\\n/gi,"\n"),c=c.replace(/\\#/gi,"#"),t=c.match(/\{random\}(.+?)\{\/random\}/i),m=0;t;){if(m++>this.master._depth){this.warn("Infinite loop looking for random tag!");break}y=[],H=t[1],y=H.indexOf("|")>-1?H.split("|"):H.split(" "),w=y[parseInt(Math.random()*y.length)],c=c.replace(new RegExp("\\{random\\}"+g.quotemeta(H)+"\\{\\/random\\}","ig"),w),t=c.match(/\{random\}(.+?)\{\/random\}/i)}for(l=["person","formal","sentence","uppercase","lowercase"],u=0,r=l.length;r>u;u++)for(I=l[u],t=c.match(new RegExp("{"+I+"}(.+?){/"+I+"}","i")),m=0;t;){if(m++,m>=50){this.warn("Infinite loop looking for "+I+" tag!");break}j=t[1],B="person"===I?this.substitute(j,"person"):g.stringFormat(I,j),c=c.replace(new RegExp("{"+I+"}"+g.quotemeta(j)+("{/"+I+"}"),"ig"),B),t=c.match(new RegExp("{"+I+"}(.+?){/"+I+"}","i"))}for(c=c.replace(/<call>/gi,"{__call__}"),c=c.replace(/<\/call>/gi,"{/__call__}");;){if(t=c.match(/<([^<]+?)>/),!t)break;t=t[1],x=t.split(" "),F=x[0].toLowerCase(),k="",x.length>1&&(k=x.slice(1).join(" ")),o="","bot"===F||"env"===F?(G="bot"===F?this.master._var:this.master._global,k.indexOf("=")>-1?(x=k.split("=",2),this.say("Set "+F+" variable "+x[0]+" = "+x[1]),G[x[0]]=x[1]):o=G[k]||"undefined"):"set"===F?(x=k.split("=",2),this.say("Set uservar "+x[0]+" = "+x[1]),this.master._users[a][x[0]]=x[1]):"add"===F||"sub"===F||"mult"===F||"div"===F?(x=k.split("="),v=x[0],J=x[1],"undefined"==typeof this.master._users[a][v]&&(this.master._users[a][v]=0),J=parseInt(J),isNaN(J)?o="[ERR: Math can't '"+F+"' non-numeric value '"+J+"']":isNaN(parseInt(this.master._users[a][v]))?o="[ERR: Math can't '"+F+"' non-numeric user variable '"+v+"']":(C=parseInt(this.master._users[a][v]),"add"===F?C+=J:"sub"===F?C-=J:"mult"===F?C*=J:"div"===F&&(0===J?o="[ERR: Can't Divide By Zero]":C/=J),""===o&&(this.master._users[a][v]=C))):o="get"===F?this.master._users[a][k]:"\x00"+t+"",c=c.replace(new RegExp("<"+g.quotemeta(t)+">"),o)}for(c=c.replace(/\x00/g,"<"),c=c.replace(/\x01/g,">"),t=c.match(/\{topic=(.+?)\}/i),m=0;t;){if(m++,m>=50){this.warn("Infinite loop looking for topic tag!");break}v=t[1],this.master._users[a].topic=v,c=c.replace(new RegExp("{topic="+g.quotemeta(v)+"}","ig"),""),t=c.match(/\{topic=(.+?)\}/i)}for(t=c.match(/\{@(.+?)\}/),m=0;t;){if(m++,m>=50){this.warn("Infinite loop looking for redirect tag!");break}G=t[1],this.say("Inline redirection to: "+G),E=this._getReply(a,G,"normal",f+1,h),c=c.replace(new RegExp("\\{@"+g.quotemeta(G)+"\\}","i"),E),t=c.match(/\{@(.+?)\}/)}return c},a.prototype.substitute=function(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p;if(n="",!this.master._sorted[b])return this.master.warn("You forgot to call sortReplies()!"),"";for(o="sub"===b?this.master._sub:this.master._person,i=[],j=0,m=this.master._sorted[b],d=0,e=m.length;e>d;d++)h=m[d],n=o[h],l=g.quotemeta(h),i.push(n),k="\x00"+j+"\x00",j++,a=a.replace(new RegExp("^"+l+"$","g"),k),a=a.replace(new RegExp("^"+l+"(\\W+)","g"),k+"$1"),a=a.replace(new RegExp("(\\W+)"+l+"(\\W+)","g"),"$1"+k+"$2"),a=a.replace(new RegExp("(\\W+)"+l+"$","g"),"$1"+k);for(p=0;a.indexOf("\x00")>-1;){if(p++,p>50){this.warn("Too many loops in substitution placeholders!");break}f=a.match("\\x00(.+?)\\x00"),f&&(c=parseInt(f[1]),n=i[c],a=a.replace(new RegExp("\x00"+c+"\x00","g"),n))}return a},a}(),b.exports=d},{"./inheritance":2,"./utils":7,rsvp:10}],2:[function(a,b,c){var d,e;e=function(a,b,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(null==c&&(c=!1),null==d&&(d=0),null==f&&(f=0),null==g&&(g=0),d>a._depth)return a.warn("Deep recursion while scanning topic inheritance!"),[];if(a.say("Collecting trigger list for topic "+b+" (depth="+d+"; "+("inheritance="+f+"; inherited="+g+")")),null==a._topics[b])return a.warn("Inherited or included topic '"+b+"' doesn't exist or has no triggers"),[];if(s=[],j=[],c){if(null!=a._thats[b])for(h in a._thats[b])if(a._thats[b].hasOwnProperty(h))for(p in a._thats[b][h])a._thats[b][h].hasOwnProperty(p)&&j.push([p,a._thats[b][h][p]])}else if(null!=a._topics[b])for(q=a._topics[b],i=0,n=q.length;n>i;i++)r=q[i],j.push([r.trigger,r]);if(Object.keys(a._includes[b]).length>0)for(k in a._includes[b])a._includes[b].hasOwnProperty(k)&&(a.say("Topic "+b+" includes "+k),s.push.apply(s,e(a,k,c,d+1,f+1,!1)));if(Object.keys(a._inherits[b]).length>0)for(l in a._inherits[b])a._inherits[b].hasOwnProperty(l)&&(a.say("Topic "+b+" inherits "+l),s.push.apply(s,e(a,l,c,d+1,f+1,!0)));if(Object.keys(a._inherits[b]).length>0||g)for(m=0,o=j.length;o>m;m++)r=j[m],a.say("Prefixing trigger with {inherits="+f+"} "+r),s.push.apply(s,[["{inherits="+f+"}"+r[0],r[1]]]);else s.push.apply(s,j);return s},d=function(a,b,c){var e,f,g;if(null==c&&(c=0),c>a._depth)return a.warn("Deep recursion while scanning topic tree!"),[];g=[b];for(e in a._topics[b].includes)a._topics[b].includes.hasOwnProperty(e)&&g.push.apply(g,d(a,e,c+1));for(f in a._topics[b].inherits)a._topics[b].inherits.hasOwnProperty(f)&&g.push.apply(g,d(a,f,c+1));return g},c.getTopicTriggers=e,c.getTopicTree=d},{}],3:[function(require,module,exports){"use strict";var JSObjectHandler;JSObjectHandler=function(){function JSObjectHandler(a){this._master=a,this._objects={}}return JSObjectHandler.prototype.load=function(name,code){var e,source;if("function"==typeof code)return this._objects[name]=code;source='this._objects["'+name+'"] = function(rs, args) {\n'+code.join("\n")+"}\n";try{return eval(source)}catch(_error){return e=_error,this._master.warn("Error evaluating JavaScript object: "+e.message)}},JSObjectHandler.prototype.call=function(a,b,c,d){var e,f,g;if(!this._objects[b])return"[ERR: Object Not Found]";f=this._objects[b],g="";try{g=f.call(d,a,c)}catch(h){e=h,g="[ERR: Error when executing JavaScript object: "+e.message+"]"}return void 0===g&&(g=""),g},JSObjectHandler}(),module.exports=JSObjectHandler},{}],4:[function(a,b,c){"use strict";var d,e,f;f=a("./utils"),e="2.0",d=function(){function a(a){this.master=a,this.strict=a._strict,this.utf8=a._utf8}return a.prototype.say=function(a){return this.master.say(a)},a.prototype.warn=function(a,b,c){return this.master.warn(a,b,c)},a.prototype.parse=function(a,b,c){var d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;for(d={begin:{global:{},"var":{},sub:{},person:{},array:{}},topics:{},objects:[]},U="random",D=0,h=!1,o=!1,P="",O="",N=[],j=null,u="",p=null,F={concat:"none"},i={none:"",newline:"\n",space:" "},E=b.split("\n"),I=q=0,w=E.length;w>q;I=++q)if(C=E[I],D=I+1,C=f.strip(C),0!==C.length)if(o)C.indexOf("< object")>-1||C.indexOf("<object")>-1?(P.length>0&&d.objects.push({name:P,language:O,code:N}),P=O="",N=[],o=!1):N.push(C);else if(0!==C.indexOf("//"))if(0!==C.indexOf("#"))if(0!==C.indexOf("/*")){if(C.indexOf("*/")>-1)h=!1;else if(!h)if(C.length<2)this.warn("Weird single-character line '"+C+"' found.",a,D);else{for(g=C.substring(0,1),C=f.strip(C.substring(1)),C.indexOf(" // ")>-1&&(C=f.strip(C.split(" // ")[0])),S=this.checkSyntax(g,C),""!==S&&(this.strict&&"function"==typeof c?c.call(null,"Syntax error: "+S+" at "+a+" line "+D+" near "+g+" "+C):this.warn("Syntax error: "+S+" at "+a+" line "+D+" near "+g+" "+C)),"+"===g&&(p=null),this.say("Cmd: "+g+"; line: "+C),R=E.slice(I+1),B=r=0,x=R.length;x>r;B=++r)if(H=R[B],H=f.strip(H),!(H.length<2)){if(G=H.substring(0,1),H=f.strip(H.substring(1)),"%"!==G&&"^"!==G)break;if(0===H.length)break;if(this.say("	Lookahead "+B+": "+G+" "+H),"+"===g){if("%"===G){p=H;break}p=null}if("!"!==g){if("^"!==g&&"%"!==G){if("^"!==G)break;C+=void 0!==i[F.concat]?i[F.concat]+H:H}}else"^"===G&&(C+="<crlf>"+H)}switch(g){case"!":if(m=C.split("=",2),v=f.strip(m[0]).split(" "),X=V=M="",2===m.length&&(X=f.strip(m[1])),v.length>=1&&(V=f.strip(v[0]),v.length>=2&&(v.shift(),M=f.strip(v.join(" ")))),"array"!==V&&(X=X.replace(/<crlf>/g,"")),"version"===V){if(parseFloat(X)>parseFloat(e))return this.warn("Unsupported RiveScript version. We only support "+e,a,D),!1;continue}if(0===M.length){this.warn("Undefined variable name",a,D);continue}if(0===X.length){this.warn("Undefined variable value",a,D);continue}switch(V){case"local":this.say("	Set local parser option "+M+" = "+X),F[M]=X;break;case"global":this.say("	Set global "+M+" = "+X),d.begin.global[M]=X;break;case"var":this.say("	Set bot variable "+M+" = "+X),d.begin["var"][M]=X;break;case"array":if(this.say("	Set array "+M+" = "+X),"<undef>"===X){d.begin.array[M]="<undef>";continue}for(Q=X.split("<crlf>"),l=[],s=0,y=Q.length;y>s;s++)W=Q[s],W.indexOf("|")>-1?l.push.apply(l,W.split("|")):l.push.apply(l,W.split(" "));for(n=J=0,z=l.length;z>J;n=++J)k=l[n],l[n]=l[n].replace(/\\s/gi," ");d.begin.array[M]=l;break;case"sub":this.say("	Set substitution "+M+" = "+X),d.begin.sub[M]=X;break;case"person":this.say("	Set person substitution "+M+" = "+X),d.begin.person[M]=X;break;default:this.warn("Unknown definition type "+V,a,D)}break;case">":switch(T=f.strip(C).split(" "),V=T.shift(),M="",l=[],T.length>0&&(M=T.shift()),T.length>0&&(l=T),V){case"begin":case"topic":if("begin"===V&&(this.say("Found the BEGIN block."),V="topic",M="__begin__"),this.say("Set topic to "+M),j=null,U=M,this.initTopic(d.topics,U),K="",l.length>=2)for(L=0,A=l.length;A>L;L++)k=l[L],"includes"===k||"inherits"===k?K=k:""!==K&&(d.topics[U][K][k]=1);break;case"object":t="",l.length>0&&(t=l[0].toLowerCase()),""===t&&(this.warn("Trying to parse unknown programming language",a,D),t="javascript"),P=M,O=t,N=[],o=!0;break;default:this.warn("Unknown label type "+V,a,D)}break;case"<":V=C,"begin"===V||"topic"===V?(this.say("	End the topic label."),U="random"):"object"===V&&(this.say("	End the object label."),o=!1);break;case"+":this.say("	Trigger pattern: "+C),this.initTopic(d.topics,U),j={trigger:C,reply:[],condition:[],redirect:null,previous:p},d.topics[U].triggers.push(j);break;case"-":if(null===j){this.warn("Response found before trigger",a,D);continue}this.say("	Response: "+C),j.reply.push(C);break;case"*":if(null===j){this.warn("Condition found before trigger",a,D);continue}this.say("	Condition: "+C),j.condition.push(C);break;case"%":continue;case"^":continue;case"@":this.say("	Redirect response to: "+C),j.redirect=f.strip(C);break;default:this.warn("Unknown command '"+g+"'",a,D)}}}else{if(C.indexOf("*/")>-1)continue;h=!0}else this.warn("Using the # symbol for comments is deprecated",a,D);return d},a.prototype.stringify=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;for(null==a&&(a=this.master.deparse()),b=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(d=b?"	":"",k=[],e=0,h=a.length;h>e;e++){if(o=a[e],k.push(d+"+ "+o.trigger),o.previous&&k.push(d+"% "+o.previous),o.condition)for(m=o.condition,f=0,i=m.length;i>f;f++)c=m[f],k.push(d+"* "+c);if(o.redirect&&k.push(d+"@ "+o.redirect),o.reply)for(n=o.reply,g=0,j=n.length;j>g;g++)l=n[g],k.push(d+"- "+l);k.push("")}return k},s=["! version = 2.0","! local concat = none",""],p=["global","var","sub","person","array"],h=0,l=p.length;l>h;h++)if(c=p[h],null!=a.begin[c]&&Object.keys(a.begin[c]).length){q=a.begin[c];for(j in q)if(y=q[j],a.begin[c].hasOwnProperty(j))if("array"!==c)s.push("! "+c+" "+j+" = "+y);else{for(o=" ",i=0,m=y.length;m>i;i++)if(v=y[i],v.match(/\s+/)){o="|";break}s.push("! "+c+" "+j+" = "+y.join(o))}s.push("")}for((null!=(r=a.begin.triggers)?r.length:void 0)&&(s.push("> begin\n"),s.push.apply(s,b(a.begin.triggers,"indent")),s.push("< begin\n")),x=Object.keys(a.topics).sort(function(a,b){return a-b}),x.unshift("random"),d=!1,k=0,n=x.length;n>k;k++)if(w=x[k],a.topics.hasOwnProperty(w)&&("random"!==w||!d)){if("random"===w&&(d=1),t=!1,u=[],"random"!==w||Object.keys(a.inherits[w]).length>0||Object.keys(a.includes[w]).length>0){"random"!==w&&(t=!0),g=[],f=[];for(e in a.inherits[w])a.inherits[w].hasOwnProperty(e)&&g.push(e);for(e in a.includes[w])a.includes[w].hasOwnProperty(e)&&f.push(e);f.length>0&&(f.unshift("includes"),u.push.apply(u,f),t=!0),g.length>0&&(g.unshift("inherits"),u.push.apply(u,g),t=!0)}t&&s.push("> topic "+w+" "+u.join(" ")+"\n"),s.push.apply(s,b(a.topics[w],t)),t&&s.push("< topic\n")}return s.join("\n")},a.prototype.checkSyntax=function(a,b){var c,d,e,f,g,h,i,j,k;if("!"===a){if(!b.match(/^.+(?:\s+.+|)\s*=\s*.+?$/))return"Invalid format for !Definition line: must be '! type name = value' OR '! type = value'"}else if(">"===a){if(j=b.split(/\s+/),"begin"===j[0]&&j.length>1)return"The 'begin' label takes no additional arguments";if("topic"===j[0]){if(b.match(/[^a-z0-9_\-\s]/))return"Topics should be lowercased and contain only letters and numbers"}else if("object"===j[0]&&b.match(/[^A-Za-z0-9\_\-\s]/))return"Objects can only contain numbers and letters"}else if("+"===a||"%"===a||"@"===a){if(i=k=f=c=0,this.utf8){if(b.match(/[A-Z\\.]/))return"Triggers can't contain uppercase letters, backslashes or dots in UTF-8 mode"}else if(b.match(/[^a-z0-9(|)\[\]*_#@{}<>=\s]/))return"Triggers may only contain lowercase letters, numbers, and these symbols: ( | ) [ ] * _ # { } < > =";for(e=b.split(""),g=0,h=e.length;h>g;g++)switch(d=e[g]){case"(":i++;break;case")":i--;break;case"[":k++;break;case"]":k--;break;case"{":f++;break;case"}":f--;break;case"<":c++;break;case">":c--}if(0!==i)return"Unmatched parenthesis brackets";if(0!==k)return"Unmatched square brackets";if(0!==f)return"Unmatched curly brackets";if(0!==c)return"Unmatched angle brackets"}else if("*"===a&&!b.match(/^.+?\s*(?:==|eq|!=|ne|<>|<|<=|>|>=)\s*.+?=>.+?$/))return"Invalid format for !Condition: should be like '* value symbol value => response'";return""},a.prototype.initTopic=function(a,b){return null==a[b]?a[b]={includes:{},inherits:{},triggers:[]}:void 0},a}(),b.exports=d},{"./utils":7}],5:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l;i="1.4.0",f=a("./parser"),d=a("./brain"),l=a("./utils"),k=a("./sorting"),j=a("./inheritance"),e=a("./lang/javascript"),g=a("rsvp"),h=function(){function c(a){null==a&&(a={}),this._debug=a.debug?a.debug:!1,this._strict=a.strict?a.strict:!0,this._depth=a.depth?parseInt(a.depth):50,this._utf8=a.utf8?a.utf8:!1,this._onDebug=a.onDebug?a.onDebug:null,this.unicodePunctuation=new RegExp(/[.,!?;:]/g),this._node={},this._runtime=this.runtime(),this.parser=new f(this),this.brain=new d(this),this._pending=[],this._loadCount=0,this._global={},this._var={},this._sub={},this._person={},this._array={},this._users={},this._freeze={},this._includes={},this._inherits={},this._handlers={},this._objlangs={},this._topics={},this._thats={},this._sorted={},"object"==typeof a&&(a.debug&&(this._debug=!0),a.strict&&(this._strict=!0),a.depth&&(this._depth=parseInt(a.depth)),a.utf8&&(this._utf8=!0)),this._handlers.javascript=new e(this),this.say("RiveScript Interpreter v"+i+" Initialized."),this.say("Runtime Environment: "+this._runtime)}return c.prototype.version=function(){return i},c.prototype.Promise=g.Promise,c.prototype.runtime=function(){return"undefined"==typeof window&&"object"==typeof b?(this._node.fs=a("fs"),"node"):"web"},c.prototype.say=function(a){return this._debug===!0?this._onDebug?this._onDebug(a):console.log(a):void 0},c.prototype.warn=function(a,b,c){return null!=b&&null!=c&&(a+=" at "+b+" line "+c),this._onDebug?this._onDebug("[WARNING] "+a):console?console.error?console.error(a):console.log("[WARNING] "+a):window?window.alert(a):void 0},c.prototype.loadFile=function(a,b,c){var d,e,f,g;for("string"==typeof a&&(a=[a]),g=this._loadCount++,this._pending[g]={},e=0,f=a.length;f>e;e++)d=a[e],this.say("Request to load file: "+d),this._pending[g][d]=1,"web"===this._runtime?this._ajaxLoadFile(g,d,b,c):this._nodeLoadFile(g,d,b,c);return g},c.prototype._ajaxLoadFile=function(a,b,c,d){return $.ajax({url:b,dataType:"text",success:function(e){return function(f,g,h){return e.say("Loading file "+b+" complete."),e.parse(b,f,d),delete e._pending[a][b],0===Object.keys(e._pending[a]).length&&"function"==typeof c?c.call(void 0,a):void 0}}(this),error:function(b){return function(c,e,f){return b.say("Ajax error! "+e+"; "+f),"function"==typeof d?d.call(void 0,e,a):void 0}}(this)})},c.prototype._nodeLoadFile=function(a,b,c,d){return this._node.fs.readFile(b,function(e){return function(f,g){return f?void("function"==typeof d?d.call(void 0,f,a):e.warn(f)):(e.parse(b,""+g,d),delete e._pending[a][b],0===Object.keys(e._pending[a]).length&&"function"==typeof c?c.call(void 0,a):void 0)}}(this))},c.prototype.loadDirectory=function(a,b,c){var d;return"web"===this._runtime?void this.warn("loadDirectory can't be used on the web!"):(d=this._loadCount++,this._pending[d]={},this.say("Loading batch "+d+" from directory "+a),this._node.fs.readdir(a,function(e){return function(f,g){var h,i,j,k,l,m,n;if(f)return void("function"==typeof c?c.call(void 0,f):e.warn(f));for(n=[],i=0,k=g.length;k>i;i++)h=g[i],h.match(/\.(rive|rs)$/i)&&(e._pending[d][a+"/"+h]=1,n.push(a+"/"+h));for(m=[],j=0,l=n.length;l>j;j++)h=n[j],e.say("Parsing file "+h+" from directory"),m.push(e._nodeLoadFile(d,h,b,c));return m}}(this)))},c.prototype.stream=function(a,b){return this.say("Streaming code."),this.parse("stream()",a,b)},c.prototype.parse=function(a,b,c){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w;this.say("Parsing code!"),d=this.parser.parse(a,b,c),n=d.begin;for(u in n)if(w=n[u],d.begin.hasOwnProperty(u)){g="_"+u;for(k in w)v=w[k],w.hasOwnProperty(k)&&("<undef>"===v?delete this[g][k]:this[g][k]=v);null!=this._global.debug&&(this._debug="true"===this._global.debug?!0:!1),null!=this._global.depth&&(this._depth=parseInt(this._global.depth)||50)}o=d.topics;for(s in o)if(e=o[s],d.topics.hasOwnProperty(s))for(null==this._includes[s]&&(this._includes[s]={}),null==this._inherits[s]&&(this._inherits[s]={}),l.extend(this._includes[s],e.includes),l.extend(this._inherits[s],e.inherits),null==this._topics[s]&&(this._topics[s]=[]),p=e.triggers,f=0,i=p.length;i>f;f++)t=p[f],this._topics[s].push(t),null!=t.previous&&(null==this._thats[s]&&(this._thats[s]={}),null==this._thats[s][t.trigger]&&(this._thats[s][t.trigger]={}),this._thats[s][t.trigger][t.previous]=t);for(q=d.objects,r=[],h=0,j=q.length;j>h;h++)m=q[h],this._handlers[m.language]?(this._objlangs[m.name]=m.language,r.push(this._handlers[m.language].load(m.name,m.code))):r.push(void 0);return r},c.prototype.sortReplies=function(){var a,b,c;this._sorted.topics={},this._sorted.thats={},this.say("Sorting triggers...");for(c in this._topics)this._topics.hasOwnProperty(c)&&(this.say("Analyzing topic "+c+"..."),a=j.getTopicTriggers(this,c),this._sorted.topics[c]=k.sortTriggerSet(a,!0),b=j.getTopicTriggers(this,c,!0),this._sorted.thats[c]=k.sortTriggerSet(b,!1));return this._sorted.sub=k.sortList(Object.keys(this._sub)),this._sorted.person=k.sortList(Object.keys(this._person))},c.prototype.deparse=function(){var a;return a={begin:{global:l.clone(this._global),"var":l.clone(this._var),sub:l.clone(this._sub),person:l.clone(this._person),array:l.clone(this._array),triggers:[]},topics:l.clone(this._topics),inherits:l.clone(this._inherits),includes:l.clone(this._includes)},null!=a.topics.__begin__&&(a.begin.triggers=a.topics.__begin__,delete a.topics.__begin__),this._debug&&(a.begin.global.debug=this._debug),50!==this._depth&&(a.begin.global.depth=this._depth),a},c.prototype.stringify=function(a){return this.parser.stringify(a)},c.prototype.write=function(a,b){return"web"===this._runtime?void this.warn("write() can't be used on the web!"):this._node.fs.writeFile(a,this.stringify(b),function(b){return b?this.warn("Error writing to file "+a+": "+b):void 0})},c.prototype.setHandler=function(a,b){return void 0===b?delete this._handlers[a]:this._handlers[a]=b},c.prototype.setSubroutine=function(a,b){return this._handlers.javascript?(this._objlangs[a]="javascript",this._handlers.javascript.load(a,b)):void 0},c.prototype.setGlobal=function(a,b){return void 0===b?delete this._global[a]:this._global[a]=b},c.prototype.setVariable=function(a,b){return void 0===b?delete this._var[a]:this._var[a]=b},c.prototype.setSubstitution=function(a,b){return void 0===b?delete this._sub[a]:this._sub[a]=b},c.prototype.setPerson=function(a,b){return void 0===b?delete this._person[a]:this._person[a]=b},c.prototype.setUservar=function(a,b,c){return this._users[a]||(this._users[a]={topic:"random"}),void 0===c?delete this._users[a][b]:this._users[a][b]=c},c.prototype.setUservars=function(a,b){var c,d;this._users[a]||(this._users[a]={topic:"random"}),d=[];for(c in b)b.hasOwnProperty(c)&&(void 0===b[c]?d.push(delete this._users[a][c]):d.push(this._users[a][c]=b[c]));return d},c.prototype.getVariable=function(a,b){return"undefined"!=typeof this._var[b]?this._var[b]:"undefined"},c.prototype.getUservar=function(a,b){return this._users[a]&&"undefined"!=typeof this._users[a][b]?this._users[a][b]:"undefined";
},c.prototype.getUservars=function(a){return void 0===a?l.clone(this._users):null!=this._users[a]?l.clone(this._users[a]):void 0},c.prototype.clearUservars=function(a){return void 0===a?this._users={}:delete this._users[a]},c.prototype.freezeUservars=function(a){return null!=this._users[a]?this._freeze[a]=l.clone(this._users[a]):this.warn("Can't freeze vars for user "+a+": not found!")},c.prototype.thawUservars=function(a,b){return null==b&&(b="thaw"),"string"!=typeof b&&(b="thaw"),null==this._freeze[a]?void this.warn("Can't thaw user vars: "+a+" wasn't frozen!"):"thaw"===b?(this.clearUservars(a),this._users[a]=l.clone(this._freeze[a]),delete this._freeze[a]):"discard"===b?delete this._freeze[a]:"keep"===b?(this.clearUservars(a),this._users[a]=l.clone(this._freeze[a])):this.warn("Unsupported thaw action!")},c.prototype.lastMatch=function(a){return null!=this._users[a]?this._users[a].__lastmatch__:void 0},c.prototype.currentUser=function(){return void 0===this.brain._currentUser&&this.warn("currentUser() is intended to be called from within a JS object macro!"),this.brain._currentUser},c.prototype.reply=function(a,b,c){return this.brain.reply(a,b,c)},c.prototype.replyAsync=function(a,b,c,d){var e;return e=this.brain.reply(a,b,c,!0),d&&e.then(function(a){return function(b){return d.call(a,null,b)}}(this))["catch"](function(a){return function(b){return d.call(a,b,null)}}(this)),e},c}(),b.exports=h},{"./brain":1,"./inheritance":2,"./lang/javascript":3,"./parser":4,"./sorting":6,"./utils":7,fs:8,rsvp:10}],6:[function(a,b,c){var d,e;e=a("./utils"),c.sortTriggerSet=function(a,b,c){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;for(null==c&&(c=function(a){}),null==b&&(b=!0),B={0:[]},h=0,p=a.length;p>h;h++)K=a[h],b&&null!=K[1].previous||(w=K[0].match(/\{weight=(\d+)\}/i),M=0,w&&w[1]&&(M=w[1]),null==B[M]&&(B[M]=[]),B[M].push(K));for(F=[],C=Object.keys(B).sort(function(a,b){return b-a}),k=0,q=C.length;q>k;k++){for(y=C[k],c("Sorting triggers with priority "+y),i=-1,g=-1,I={},I[i]=d(),D=B[y],l=0,r=D.length;r>l;l++)K=D[l],z=K[0],c("Looking at trigger: "+z),w=z.match(/\{inherits=(\d+)\}/i),w?(i=parseInt(w[1]),i>g&&(g=i),c("Trigger belongs to a topic that inherits other topics. Level="+i),z=z.replace(/\{inherits=\d+\}/gi,""),K[0]=z):i=-1,null==I[i]&&(I[i]=d()),z.indexOf("_")>-1?(f=e.word_count(z),c("Has a _ wildcard with "+f+" words."),f>0?(null==I[i].alpha[f]&&(I[i].alpha[f]=[]),I[i].alpha[f].push(K)):I[i].under.push(K)):z.indexOf("#")>-1?(f=e.word_count(z),c("Has a # wildcard with "+f+" words."),f>0?(null==I[i].number[f]&&(I[i].number[f]=[]),I[i].number[f].push(K)):I[i].pound.push(K)):z.indexOf("*")>-1?(f=e.word_count(z),c("Has a * wildcard with "+f+" words."),f>0?(null==I[i].wild[f]&&(I[i].wild[f]=[]),I[i].wild[f].push(K)):I[i].star.push(K)):z.indexOf("[")>-1?(f=e.word_count(z),c("Has optionals with "+f+" words."),null==I[i].option[f]&&(I[i].option[f]=[]),I[i].option[f].push(K)):(f=e.word_count(z),c("Totally atomic trigger with "+f+" words."),null==I[i].atomic[f]&&(I[i].atomic[f]=[]),I[i].atomic[f].push(K));for(I[g+1]=I[-1],delete I[-1],J=Object.keys(I).sort(function(a,b){return a-b}),o=0,s=J.length;s>o;o++){for(j=J[o],c("ip="+j),E=["atomic","option","alpha","number","wild"],v=0,t=E.length;t>v;v++)for(m=E[v],n=Object.keys(I[j][m]).sort(function(a,b){return b-a}),x=0,u=n.length;u>x;x++)N=n[x],G=I[j][m][N].sort(function(a,b){return b.length-a.length}),F.push.apply(F,G);L=I[j].under.sort(function(a,b){return b.length-a.length}),A=I[j].pound.sort(function(a,b){return b.length-a.length}),H=I[j].star.sort(function(a,b){return b.length-a.length}),F.push.apply(F,L),F.push.apply(F,A),F.push.apply(F,H)}}return F},c.sortList=function(a){var b,c,d,f,g,h,i,j,k,l,m;for(m={},f=0,i=a.length;i>f;f++)g=a[f],c=e.word_count(g,!0),null==m[c]&&(m[c]=[]),m[c].push(g);for(k=[],l=Object.keys(m).sort(function(a,b){return b-a}),h=0,j=l.length;j>h;h++)d=l[h],b=m[d].sort(function(a,b){return b.length-a.length}),k.push.apply(k,b);return k},d=function(){return{atomic:{},option:{},alpha:{},number:{},wild:{},pound:[],under:[],star:[]}}},{"./utils":7}],7:[function(a,b,c){c.strip=function(a){return a=a.replace(/^[\s\t]+/,"").replace(/[\s\t]+$/,"").replace(/[\x0D\x0A]+/,"")},c.extend=function(a,b){var c,d,e;d=[];for(c in b)e=b[c],b.hasOwnProperty(c)&&d.push(a[c]=e);return d},c.word_count=function(a,b){var c,d,e,f,g;for(g=[],g=b?a.split(/\s+/):a.split(/[\s\*\#\_\|]+/),e=0,c=0,d=g.length;d>c;c++)f=g[c],f.length>0&&e++;return e},c.stripNasties=function(a,b){return a=b?a.replace(/[\\<>]+/g,""):a.replace(/[^A-Za-z0-9 ]/g,"")},c.quotemeta=function(a){var b,c,d,e;for(e="\\.+*?[^]$(){}=!<>|:".split(""),c=0,d=e.length;d>c;c++)b=e[c],a=a.replace(new RegExp("\\"+b,"g"),"\\"+b);return a},c.isAtomic=function(a){var b,c,d,e;for(d=["*","#","_","(","[","<","@"],b=0,c=d.length;c>b;b++)if(e=d[b],a.indexOf(e)>-1)return!1;return!0},c.stringFormat=function(a,b){var c,d,e,f,g,h;if("uppercase"===a)return b.toUpperCase();if("lowercase"===a)return b.toLowerCase();if("sentence"===a)return b+="",c=b.charAt(0).toUpperCase(),c+b.substring(1);if("formal"===a){for(h=b.split(/\s+/),f=[],d=0,e=h.length;e>d;d++)g=h[d],c=g.charAt(0).toUpperCase(),f.push(c+g.substring(1));return f.join(" ")}return content},c.clone=function(a){var b,d;if(null===a||"object"!=typeof a)return a;b=a.constructor();for(d in a)a.hasOwnProperty(d)&&(b[d]=c.clone(a[d]));return b},c.isAPromise=function(a){return a&&a.then&&a["catch"]&&a["finally"]&&"function"==typeof a.then&&"function"==typeof a["catch"]&&"function"==typeof a["finally"]}},{}],8:[function(a,b,c){},{}],9:[function(a,b,c){function d(){if(!h){h=!0;for(var a,b=g.length;b;){a=g,g=[];for(var c=-1;++c<b;)a[c]();b=g.length}h=!1}}function e(){}var f=b.exports={},g=[],h=!1;f.nextTick=function(a){g.push(a),h||setTimeout(d,0)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=e,f.addListener=e,f.once=e,f.off=e,f.removeListener=e,f.removeAllListeners=e,f.emit=e,f.binding=function(a){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(a){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],10:[function(a,b,c){(function(c,d){(function(){"use strict";function e(a){return"function"==typeof a||"object"==typeof a&&null!==a}function f(a){return"function"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(){}function i(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function j(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b}function k(a,b){return"onerror"===a?void Aa.on("error",b):2!==arguments.length?Aa[a]:void(Aa[a]=b)}function l(){setTimeout(function(){for(var a,b=0;b<Ba.length;b++){a=Ba[b];var c=a.payload;c.guid=c.key+c.id,c.childGuid=c.key+c.childId,c.error&&(c.stack=c.error.stack),Aa.trigger(a.name,a.payload)}Ba.length=0},50)}function m(a,b,c){1===Ba.push({name:a,payload:{key:b._guidKey,id:b._id,eventName:a,detail:b._result,childId:c&&c._id,label:b._label,timeStamp:xa(),error:Aa["instrument-with-stack"]?new Error(b._label):null}})&&l()}function n(a,b,c){var d=this,e=d._state;if(e===Na&&!a||e===Oa&&!b)return Aa.instrument&&Ca("chained",d,d),d;d._onError=null;var f=new d.constructor(y,c),g=d._result;if(Aa.instrument&&Ca("chained",d,f),e){var h=arguments[e-1];Aa.async(function(){M(e,f,h,g)})}else I(d,f,a,b);return f}function o(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(y,b);return E(d,a),d}function p(a,b,c){return a===Na?{state:"fulfilled",value:c}:{state:"rejected",reason:c}}function q(a,b,c,d){this._instanceConstructor=a,this.promise=new a(y,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?G(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&G(this.promise,this._result))):H(this.promise,this._validationError())}function r(a,b){return new Fa(this,a,!0,b).promise}function s(a,b){function c(a){E(f,a)}function d(a){H(f,a)}var e=this,f=new e(y,b);if(!wa(a))return H(f,new TypeError("You must pass an array to race.")),f;for(var g=a.length,h=0;f._state===Ma&&g>h;h++)I(e.resolve(a[h]),void 0,c,d);return f}function t(a,b){var c=this,d=new c(y,b);return H(d,a),d}function u(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function v(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function w(a,b){this._id=Ka++,this._label=b,this._state=void 0,this._result=void 0,this._subscribers=[],Aa.instrument&&Ca("created",this),y!==a&&("function"!=typeof a&&u(),this instanceof w?N(this,a):v())}function x(){return new TypeError("A promises callback cannot return that same promise.")}function y(){}function z(a){try{return a.then}catch(b){return Pa.error=b,Pa}}function A(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function B(a,b,c){Aa.async(function(a){var d=!1,e=A(c,b,function(c){d||(d=!0,b!==c?E(a,c,void 0):G(a,c))},function(b){d||(d=!0,H(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,H(a,e))},a)}function C(a,b){b._state===Na?G(a,b._result):b._state===Oa?(b._onError=null,H(a,b._result)):I(b,void 0,function(c){b!==c?E(a,c,void 0):G(a,c)},function(b){H(a,b)})}function D(a,b,c){b.constructor===a.constructor&&c===Da&&constructor.resolve===Ea?C(a,b):c===Pa?H(a,Pa.error):void 0===c?G(a,b):f(c)?B(a,b,c):G(a,b)}function E(a,b){a===b?G(a,b):e(b)?D(a,b,z(b)):G(a,b)}function F(a){a._onError&&a._onError(a._result),J(a)}function G(a,b){a._state===Ma&&(a._result=b,a._state=Na,0===a._subscribers.length?Aa.instrument&&Ca("fulfilled",a):Aa.async(J,a))}function H(a,b){a._state===Ma&&(a._state=Oa,a._result=b,Aa.async(F,a))}function I(a,b,c,d){var e=a._subscribers,f=e.length;a._onError=null,e[f]=b,e[f+Na]=c,e[f+Oa]=d,0===f&&a._state&&Aa.async(J,a)}function J(a){var b=a._subscribers,c=a._state;if(Aa.instrument&&Ca(c===Na?"fulfilled":"rejected",a),0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?M(c,d,e,f):e(f);a._subscribers.length=0}}function K(){this.error=null}function L(a,b){try{return a(b)}catch(c){return Qa.error=c,Qa}}function M(a,b,c,d){var e,g,h,i,j=f(c);if(j){if(e=L(c,d),e===Qa?(i=!0,g=e.error,e=null):h=!0,b===e)return void H(b,x())}else e=d,h=!0;b._state!==Ma||(j&&h?E(b,e):i?H(b,g):a===Na?G(b,e):a===Oa&&H(b,e))}function N(a,b){var c=!1;try{b(function(b){c||(c=!0,E(a,b))},function(b){c||(c=!0,H(a,b))})}catch(d){H(a,d)}}function O(a,b,c){this._superConstructor(a,b,!1,c)}function P(a,b){return new O(La,a,b).promise}function Q(a,b){return La.all(a,b)}function R(a,b){ab[Va]=a,ab[Va+1]=b,Va+=2,2===Va&&Sa()}function S(){var a=c.nextTick,b=c.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(X)}}function T(){return function(){Ra(X)}}function U(){var a=0,b=new Za(X),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function V(){var a=new MessageChannel;return a.port1.onmessage=X,function(){a.port2.postMessage(0)}}function W(){return function(){setTimeout(X,1)}}function X(){for(var a=0;Va>a;a+=2){var b=ab[a],c=ab[a+1];b(c),ab[a]=void 0,ab[a+1]=void 0}Va=0}function Y(){try{var b=a,c=b("vertx");return Ra=c.runOnLoop||c.runOnContext,T()}catch(d){return W()}}function Z(a){var b={};return b.promise=new La(function(a,c){b.resolve=a,b.reject=c},a),b}function $(a,b,c){return La.all(a,c).then(function(a){if(!f(b))throw new TypeError("You must pass a function as filter's second argument.");for(var d=a.length,e=new Array(d),g=0;d>g;g++)e[g]=b(a[g]);return La.all(e,c).then(function(b){for(var c=new Array(d),e=0,f=0;d>f;f++)b[f]&&(c[e]=a[f],e++);return c.length=e,c})})}function _(a,b,c){this._superConstructor(a,b,!0,c)}function aa(a,b,c){this._superConstructor(a,b,!1,c)}function ba(a,b){return new aa(La,a,b).promise}function ca(a,b){return new db(La,a,b).promise}function da(a,b,c){return La.all(a,c).then(function(a){if(!f(b))throw new TypeError("You must pass a function as map's second argument.");for(var d=a.length,e=new Array(d),g=0;d>g;g++)e[g]=b(a[g]);return La.all(e,c)})}function ea(){this.value=void 0}function fa(a){try{return a.then}catch(b){return ib.value=b,ib}}function ga(a,b,c){try{a.apply(b,c)}catch(d){return ib.value=d,ib}}function ha(a,b){for(var c,d,e={},f=a.length,g=new Array(f),h=0;f>h;h++)g[h]=a[h];for(d=0;d<b.length;d++)c=b[d],e[c]=g[d+1];return e}function ia(a){for(var b=a.length,c=new Array(b-1),d=1;b>d;d++)c[d-1]=a[d];return c}function ja(a,b){return{then:function(c,d){return a.call(b,c,d)}}}function ka(a,b){var c=function(){for(var c,d=this,e=arguments.length,f=new Array(e+1),g=!1,h=0;e>h;++h){if(c=arguments[h],!g){if(g=na(c),g===jb){var i=new La(y);return H(i,jb.value),i}g&&g!==!0&&(c=ja(g,c))}f[h]=c}var j=new La(y);return f[e]=function(a,c){a?H(j,a):void 0===b?E(j,c):b===!0?E(j,ia(arguments)):wa(b)?E(j,ha(arguments,b)):E(j,c)},g?ma(j,f,a,d):la(j,f,a,d)};return c.__proto__=a,c}function la(a,b,c,d){var e=ga(c,d,b);return e===ib&&H(a,e.value),a}function ma(a,b,c,d){return La.all(b).then(function(b){var e=ga(c,d,b);return e===ib&&H(a,e.value),a})}function na(a){return a&&"object"==typeof a?a.constructor===La?!0:fa(a):!1}function oa(a,b){return La.race(a,b)}function pa(a,b){return La.reject(a,b)}function qa(a,b){return La.resolve(a,b)}function ra(a){throw setTimeout(function(){throw a}),a}function sa(a,b){Aa.async(a,b)}function ta(){Aa.on.apply(Aa,arguments)}function ua(){Aa.off.apply(Aa,arguments)}var va;va=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var wa=va,xa=Date.now||function(){return(new Date).getTime()},ya=Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return h.prototype=a,new h},za={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,b){if("function"!=typeof b)throw new TypeError("Callback must be a function");var c,d=j(this);c=d[a],c||(c=d[a]=[]),-1===i(c,b)&&c.push(b)},off:function(a,b){var c,d,e=j(this);return b?(c=e[a],d=i(c,b),void(-1!==d&&c.splice(d,1))):void(e[a]=[])},trigger:function(a,b,c){var d,e,f=j(this);if(d=f[a])for(var g=0;g<d.length;g++)(e=d[g])(b,c)}},Aa={instrument:!1};za.mixin(Aa);var Ba=[],Ca=m,Da=n,Ea=o,Fa=q;q.prototype._validateInput=function(a){return wa(a)},q.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},q.prototype._init=function(){this._result=new Array(this.length)},q.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===Ma&&a>d;d++)this._eachEntry(c[d],d)},q.prototype._settleMaybeThenable=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===Ea){var e=z(a);if(e===Da&&a._state!==Ma)a._onError=null,this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=this._makeResult(Na,b,a);else if(c===La){var f=new c(y);D(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){b(a)}),b)}else this._willSettleAt(d(a),b)},q.prototype._eachEntry=function(a,b){g(a)?this._settleMaybeThenable(a,b):(this._remaining--,this._result[b]=this._makeResult(Na,b,a))},q.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===Ma&&(this._remaining--,this._abortOnReject&&a===Oa?H(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&G(d,this._result)},q.prototype._makeResult=function(a,b,c){return c},q.prototype._willSettleAt=function(a,b){var c=this;I(a,void 0,function(a){c._settledAt(Na,b,a)},function(a){c._settledAt(Oa,b,a)})};var Ga=r,Ha=s,Ia=t,Ja="rsvp_"+xa()+"-",Ka=0,La=w;w.cast=Ea,w.all=Ga,w.race=Ha,w.resolve=Ea,w.reject=Ia,w.prototype={constructor:w,_guidKey:Ja,_onError:function(a){var b=this;Aa.after(function(){b._onError&&Aa.trigger("error",a,b._label)})},then:Da,"catch":function(a,b){return this.then(void 0,a,b)},"finally":function(a,b){var c=this,d=c.constructor;return c.then(function(b){return d.resolve(a()).then(function(){return b})},function(b){return d.resolve(a()).then(function(){return d.reject(b)})},b)}};var Ma=void 0,Na=1,Oa=2,Pa=new K,Qa=new K;O.prototype=ya(Fa.prototype),O.prototype._superConstructor=Fa,O.prototype._makeResult=p,O.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Ra,Sa,Ta=P,Ua=Q,Va=0,Wa=({}.toString,R),Xa="undefined"!=typeof window?window:void 0,Ya=Xa||{},Za=Ya.MutationObserver||Ya.WebKitMutationObserver,$a="undefined"==typeof self&&"undefined"!=typeof c&&"[object process]"==={}.toString.call(c),_a="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ab=new Array(1e3);Sa=$a?S():Za?U():_a?V():void 0===Xa&&"function"==typeof a?Y():W();var bb=Z,cb=$,db=_;_.prototype=ya(Fa.prototype),_.prototype._superConstructor=Fa,_.prototype._init=function(){this._result={}},_.prototype._validateInput=function(a){return a&&"object"==typeof a},_.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},_.prototype._enumerate=function(){var a=this,b=a.promise,c=a._input,d=[];for(var e in c)b._state===Ma&&Object.prototype.hasOwnProperty.call(c,e)&&d.push({position:e,entry:c[e]});var f=d.length;a._remaining=f;for(var g,h=0;b._state===Ma&&f>h;h++)g=d[h],a._eachEntry(g.entry,g.position)},aa.prototype=ya(db.prototype),aa.prototype._superConstructor=Fa,aa.prototype._makeResult=p,aa.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var eb,fb=ba,gb=ca,hb=da,ib=new ea,jb=new ea,kb=ka;if("object"==typeof self)eb=self;else{if("object"!=typeof d)throw new Error("no global: `self` or `global` found");eb=d}var lb=eb,mb=oa,nb=pa,ob=qa,pb=ra;Aa.async=Wa,Aa.after=function(a){setTimeout(a,0)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var qb=window.__PROMISE_INSTRUMENTATION__;k("instrument",!0);for(var rb in qb)qb.hasOwnProperty(rb)&&ta(rb,qb[rb])}var sb={race:mb,Promise:La,allSettled:Ta,hash:gb,hashSettled:fb,denodeify:kb,on:ta,off:ua,map:hb,filter:cb,resolve:ob,reject:nb,all:Ua,rethrow:pb,defer:bb,EventTarget:za,configure:k,async:sa};"function"==typeof define&&define.amd?define(function(){return sb}):"undefined"!=typeof b&&b.exports?b.exports=sb:"undefined"!=typeof lb&&(lb.RSVP=sb)}).call(this)}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:9}]},{},[5])(5)});